{% extends 'base.html' %}
{% load humanize %}
{% load static %}
{% block content %}
<div class="container-fluid mt-4" >
   <div class="row">
      <!-- Main Content -->
      <div class="col-12 col-lg-10">
         <!-- Reduced width to 8 -->
         <!-- Performance Cards -->
         <div class="row g-4">
            <!-- My Performance Section -->
            <div class="col-12 col-lg-6">
               <div class="p-3 shadow-sm" style="border-radius: 10px;">
                  <h4 class="text-center mb-3 perform">My Performance</h4>
                  <div class="row g-3">
                     <div class="col-12 col-sm-6 col-md-6 mb-4">
                        <div class="card h-100 custom-card">
                           <div class="card-body">
                              <h5 class="card-title">Deductions</h5>
                              <p id="my-deductions" class="card-text">${{ deductions_sum|floatformat:0|intcomma }}</p>
                              <span class="badge bg-success badge-sm">+10%</span>
                           </div>
                        </div>
                     </div>
                     <div class="col-12 col-sm-6 col-md-6 mb-4">
                        <div class="card h-100 custom-card">
                           <div class="card-body">
                              <h5 class="card-title">Valids</h5>
                              <p id="my-valids" class="card-text">${{ valid_sum|floatformat:0|intcomma }}</p>
                              <span class="badge bg-success badge-sm">+5%</span>
                           </div>
                        </div>
                     </div>
                     <div class="col-12 col-sm-6 col-md-6 mb-4">
                        <div class="card h-100 custom-card">
                           <div class="card-body">
                              <h5 class="card-title">Invalids</h5>
                              <p id="my-invalids" class="card-text">${{ invalid_sum|floatformat:0|intcomma }}</p>
                              <span class="badge bg-danger badge-sm">-3%</span>
                           </div>
                        </div>
                     </div>
                     <div class="col-12 col-sm-6 col-md-6 mb-4">
                        <div class="card h-100 custom-card">
                           <div class="card-body">
                              <h5 class="card-title">Recovery</h5>
                              <p id="my-recovery" class="card-text">${{ recovered_sum|floatformat:0|intcomma }}</p>
                              <span class="badge bg-warning text-dark badge-sm">+2%</span>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <!-- Team's Performance Section -->
            <div class="col-12 col-lg-6">
               <div class="p-3 shadow-sm" style="border-radius: 10px;">
                  <h4 class="text-center mb-3 perform">Team's Performance</h4>
                  <div class="row g-3">
                     <div class="col-12 col-sm-6 col-md-6 mb-4">
                        <div class="card h-100 custom-card">
                           <div class="card-body">
                              <h5 class="card-title">Deductions</h5>
                              <p id="team-deductions" class="card-text">${{ deductions_sum|floatformat:0|intcomma }}</p>
                              <span class="badge bg-success badge-sm">+8%</span>
                           </div>
                        </div>
                     </div>
                     <div class="col-12 col-sm-6 col-md-6 mb-4">
                        <div class="card h-100 custom-card">
                           <div class="card-body">
                              <h5 class="card-title">Valids</h5>
                              <p id="team-valids" class="card-text">${{ valid_sum|floatformat:0|intcomma }}</p>
                              <span class="badge bg-success badge-sm">+4%</span>
                           </div>
                        </div>
                     </div>
                     <div class="col-12 col-sm-6 col-md-6 mb-4">
                        <div class="card h-100 custom-card">
                           <div class="card-body">
                              <h5 class="card-title">Invalids</h5>
                              <p id="team-invalids" class="card-text">${{ invalid_sum|floatformat:0|intcomma }}</p>
                              <span class="badge bg-danger badge-sm">-2%</span>
                           </div>
                        </div>
                     </div>
                     <div class="col-12 col-sm-6 col-md-6 mb-4">
                        <div class="card h-100 custom-card">
                           <div class="card-body">
                              <h5 class="card-title">Recovery</h5>
                              <p id="team-recovery" class="card-text">${{ recovered_sum|floatformat:0|intcomma }}</p>
                              <span class="badge bg-warning text-dark badge-sm">+1%</span>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <!-- Graphs Row -->
         <div class="row mt-4">
            <!-- Line Chart (70%) -->
            <div class="col-12 col-lg-8 mb-4">
               <div class="card h-100 shadow-sm" style="border-radius:10px; border:none; overflow: hidden;">
                  <div class="card-body">
                     <h5 class="card-title">Daily Transactions Worked</h5>
                     <canvas id="dailyTransactionsChart" style="height: 300px;"></canvas>
                  </div>
               </div>
            </div>
            <!-- Donut Chart (30%) -->
            <div class="col-12 col-lg-4 mb-4">
               <div class="card h-100 shadow-sm" style="border-radius: 10px; overflow: hidden;">
                  <div class="card-body">
                     <h5 class="card-title">Top 10 Customers</h5>
                     <canvas id="topCustomersDonutChart" style="height: 300px;"></canvas>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- Right Sidebar (Filters) -->
      <div class="col-12 col-lg-2" style="padding-bottom: 20px; padding-Top: 0px;">
         <div class="card shadow-sm text-center" style="border-radius: 10px;">
            <div class="filters mt-3 px-2">
               <h5 class="text-center">Filter Data</h5>
               <!-- Filter Form -->
               <form id="filter-form" class="d-flex flex-column align-items-center">                  
                  <div class="form-group w-100 text-left">
                     <label for="standard_customer">Standard Customer</label>
                     <select class="form-control" id="standard_customer" name="standard_customer">
                        <option value="">All</option>
                        {% for customer in standard_customers %}
                        <option value="{{ customer.standard_customer }}" {% if customer.standard_customer == selected_customer %}selected{% endif %}>
                            {{ customer.standard_customer }}
                        </option>
                        {% endfor %}
                     </select>
                  </div>
                  <div class="form-group w-100 text-left">
                     <label>Deducted Amount Range</label>
                     <div class="input-group mb-2">
                        <div class="input-group-prepend">
                           <span class="input-group-text">$</span>
                        </div>
                        <input type="number" class="form-control" id="deducted_amount_min" name="deducted_amount_min" placeholder="Min" min="0">
                     </div>
                     <div class="input-group">
                        <div class="input-group-prepend">
                           <span class="input-group-text">$</span>
                        </div>
                        <input type="number" class="form-control" id="deducted_amount_max" name="deducted_amount_max" placeholder="Max" min="0">
                     </div>
                  </div>
                  <div class="form-group w-100 text-left">
                     <label>Deduction Date Range</label>
                     <input type="date" class="form-control" id="deduction_date_from" name="deduction_date_from" data-toggle="tooltip" title="From Date">
                     <input type="date" class="form-control mt-2" id="deduction_date_to" name="deduction_date_to" data-toggle="tooltip" title="To Date">
                  </div>
                  <div class="form-group w-100 text-left">
                     <label for="validation_status">Validation Status</label>
                     <select class="form-control" id="validation_status" name="validation_status">
                        <option value="">All</option>
                        <option value="Valid">Valid</option>
                        <option value="Invalid">Invalid</option>
                        <option value="Pending Validation">Pending Validation</option>
                     </select>
                  </div>
                  <div class="col-12">
                     <button type="submit" id="filter-button" class="btn btn-primary">Apply Filters</button>
                     <button type="reset" id="resetFilters" class="btn btn-secondary">Reset</button>
                  </div>
               </form>
            </div>
         </div>
      </div>
      <!-- End Right Sidebar -->
   </div>
   <!-- End row -->
   <!-- Table -->
   <div class="mt-5">
      <div class="card shadow-sm">
         <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-table mr-2"></i> Deductions Data</h5>
         </div>
         <div class="card-body">
            <div class="table-responsive">
               <table id="dashboard-table" class="table table-bordered table-hover data-table" width="100%">
                  <thead>
                     <tr>
                        <th>Invoice</th>
                        <th>Customer</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Date</th>
                     </tr>
                  </thead>
                  <tbody>
                     {% for record in records %}
                     <tr>
                        <td data-field="invoice_number">
                           <a href="#" 
                              class="edit-deduction" 
                              data-invoice="{{ record.invoice_number|stringformat:"s" }}"
                              data-toggle="modal" 
                              data-target="#deductionDetailModal">
                           {{ record.invoice_number|stringformat:"s" }}
                           </a>
                        </td>
                        <td data-field="customer">{{ record.customer }}</td>
                        <td data-field="amount">${{ record.amount|floatformat:2 }}</td>
                        <td data-field="status">
                           <span class="{% if record.status == 'Valid' %}text-success{% elif record.status == 'Invalid' %}text-danger{% elif record.status == 'Pending Validation' %}text-warning{% endif %}">
                           {{ record.status }}
                           </span>
                        </td>
                        <td data-field="date">{{ record.date|date:"m/d/y" }}</td>
                     </tr>
                     {% endfor %}
                  </tbody>
               </table>
            </div>
         </div>
      </div>
   </div>
</div>
<!-- End container -->
<!-- Load charts.js first -->
<script src="{% static 'js/charts.js' %}"></script>
{% endblock %}